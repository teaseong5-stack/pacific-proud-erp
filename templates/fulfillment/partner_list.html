{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>ğŸ¢ ê±°ë˜ì²˜ ê´€ë¦¬</h2>
    
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPartnerModal">
        <i class="bi bi-plus-lg"></i> ì‹ ê·œ ê±°ë˜ì²˜ ë“±ë¡
    </button>
</div>

<div class="card shadow-sm mb-4 bg-light">
    <div class="card-body py-3">
        <form method="get" class="row g-2 align-items-end">
            <div class="col-md-4">
                <label class="form-label fw-bold small">ìƒí˜¸ëª…</label>
                <input type="text" name="name" class="form-control" value="{{ request.GET.name }}" placeholder="ìƒí˜¸ëª… ê²€ìƒ‰">
            </div>

            <div class="col-md-3">
                <label class="form-label fw-bold small">ê±°ë˜ì²˜ êµ¬ë¶„</label>
                <select name="partner_type" class="form-select">
                    <option value="">ì „ì²´ ë³´ê¸°</option>
                    <option value="SUPPLIER" {% if request.GET.partner_type == 'SUPPLIER' %}selected{% endif %}>ë§¤ì…ì²˜ (ê³µê¸‰ì‚¬)</option>
                    <option value="CLIENT" {% if request.GET.partner_type == 'CLIENT' %}selected{% endif %}>ë§¤ì¶œì²˜ (ë‚©í’ˆì²˜)</option>
                    <option value="BOTH" {% if request.GET.partner_type == 'BOTH' %}selected{% endif %}>í˜¼í•©</option>
                </select>
            </div>

            <div class="col-md-3 d-flex gap-2">
                <button type="submit" class="btn btn-secondary flex-fill">
                    <i class="bi bi-search"></i> ì¡°íšŒ
                </button>
                <a href="{% url 'fulfillment:partner_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-counterclockwise"></i>
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm mt-3">
    <div class="card-body p-0">
        <table class="table table-hover align-middle mb-0" style="font-size: 0.95rem;">
            <thead class="table-light">
                <tr>
                    <th style="width: 10%;">êµ¬ë¶„</th>
                    <th style="width: 15%;">ìƒí˜¸ëª…</th>
                    <th style="width: 15%;">ëŒ€í‘œì (ì—°ë½ì²˜)</th>
                    <th style="width: 10%;">ë‹´ë‹¹ì</th>
                    <th style="width: 15%;">ë‹´ë‹¹ì ì—°ë½ì²˜</th>
                    <th style="width: 20%;">ì£¼ì†Œ</th> 
                    <th style="width: 10%;" class="text-end">ì”ì•¡</th>
                    <th style="width: 5%;" class="text-center">ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                {% for p in partners %}
                <tr>
                    <td>
                        {% if p.partner_type == 'SUPPLIER' %}<span class="badge bg-secondary">ë§¤ì…ì²˜</span>
                        {% elif p.partner_type == 'CLIENT' %}<span class="badge bg-primary">ë§¤ì¶œì²˜</span>
                        {% else %}<span class="badge bg-info text-dark">í˜¼í•©</span>{% endif %}
                    </td>
                    
                    <td class="fw-bold">{{ p.name }}</td>
                    
                    <td>
                        {{ p.owner_name|default:"-" }}
                        {% if p.phone %}<br><small class="text-muted">{{ p.phone }}</small>{% endif %}
                    </td>
                    
                    <td>{{ p.contact_person|default:"-" }}</td>
                    
                    <td>{{ p.contact_phone|default:"-" }}</td>
                    
                    <td class="text-truncate" style="max-width: 150px;" title="{{ p.address }}">
                        {{ p.address|default:"-" }}
                    </td>

                    <td class="text-end fw-bold" style="color: {% if p.current_balance >= 0 %}blue{% else %}red{% endif %};">
                        {{ p.current_balance|intcomma }} Ä‘
                    </td>

                    <td class="text-center">
                        <a href="{% url 'fulfillment:partner_update' p.id %}" class="btn btn-sm btn-outline-primary me-1">
                            <i class="bi bi-pencil-square"></i>
                        </a>
                        <a href="{% url 'fulfillment:partner_delete' p.id %}" class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="8" class="text-center p-4">ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="addPartnerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">ğŸ¢ ì‹ ê·œ ê±°ë˜ì²˜ ë“±ë¡</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'fulfillment:partner_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <h6 class="border-bottom pb-2 mb-3 text-primary fw-bold">ê¸°ë³¸ ì •ë³´</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-8"><label class="form-label fw-bold">ìƒí˜¸ëª…</label>{{ form.name }}</div>
                        <div class="col-md-4"><label class="form-label fw-bold">êµ¬ë¶„</label>{{ form.partner_type }}</div>
                        <div class="col-md-6"><label class="form-label fw-bold">ì‚¬ì—…ìë²ˆí˜¸</label>{{ form.biz_number }}</div>
                        <div class="col-md-6"><label class="form-label fw-bold">ì£¼ì†Œ</label>{{ form.address }}</div>
                    </div>
                    <h6 class="border-bottom pb-2 mb-3 text-primary fw-bold">ì—°ë½ì²˜ ì •ë³´</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6"><label class="form-label fw-bold">ëŒ€í‘œìëª…</label>{{ form.owner_name }}</div>
                        <div class="col-md-6"><label class="form-label fw-bold">ëŒ€í‘œ ì „í™”</label>{{ form.phone }}</div>
                        <div class="col-md-6"><label class="form-label fw-bold bg-light p-1 rounded">ì‹¤ë¬´ ë‹´ë‹¹ìëª…</label>{{ form.contact_person }}</div>
                        <div class="col-md-6"><label class="form-label fw-bold bg-light p-1 rounded">ë‹´ë‹¹ì íœ´ëŒ€í°</label>{{ form.contact_phone }}</div>
                    </div>
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label fw-bold">ê¸°ì´ˆ ì´ì›” ì”ì•¡</label>
                            <div class="input-group">{{ form.initial_balance }}<span class="input-group-text">Ä‘</span></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ë“±ë¡ ì™„ë£Œ</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}