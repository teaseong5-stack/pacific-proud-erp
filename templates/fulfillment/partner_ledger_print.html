{% load humanize %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ partner.name }}_ì›ì¥</title>
    <style>
        body { font-family: "Malgun Gothic", sans-serif; font-size: 10pt; color: #000; margin: 0; padding: 0; }
        
        /* ì¸ì‡„ ì„¤ì • */
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; }
            /* í˜ì´ì§€ ë‚˜ëˆ„ê¸° í•µì‹¬ ìŠ¤íƒ€ì¼ */
            .page-break { page-break-before: always; }
        }

        .container { width: 100%; max-width: 210mm; margin: 0 auto; padding: 20px; box-sizing: border-box; }
        
        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        .header { text-align: center; margin-bottom: 20px; border-bottom: 3px double #000; padding-bottom: 10px; }
        .header h1 { margin: 0; font-size: 22pt; letter-spacing: 2px; }
        .header .sub-title { font-size: 14pt; margin-top: 5px; font-weight: bold; }
        .header .date-range { font-size: 11pt; margin-top: 5px; }

        .info-section { display: flex; justify-content: space-between; margin-bottom: 20px; gap: 10px; }
        .info-box { width: 49%; border: 1px solid #000; }
        .info-header { background-color: #eee; text-align: center; padding: 5px; border-bottom: 1px solid #000; font-weight: bold; }
        
        .info-table { width: 100%; border-collapse: collapse; }
        .info-table th { padding: 4px 8px; text-align: left; background-color: #f9f9f9; border-right: 1px solid #ccc; border-bottom: 1px solid #ccc; width: 30%; font-size: 9pt; }
        .info-table td { padding: 4px 8px; border-bottom: 1px solid #ccc; font-size: 9pt; }
        .info-table tr:last-child th, .info-table tr:last-child td { border-bottom: none; }

        .ledger-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; border: 2px solid #000; table-layout: fixed; }
        .ledger-table th, .ledger-table td { border: 1px solid #000; padding: 5px; font-size: 9pt; word-wrap: break-word; }
        .ledger-table th { background-color: #eee; text-align: center; height: 30px; font-weight: bold; }
        .ledger-table td { height: 24px; vertical-align: middle; }
        
        .summary-box { border: 2px solid #000; padding: 10px; page-break-inside: avoid; background-color: #fdfdfd; }
        .summary-table { width: 100%; }
        .summary-table th { text-align: left; font-size: 10pt; padding: 3px; }
        .summary-table td { text-align: right; font-size: 11pt; font-weight: bold; padding: 3px; }
        .total-row th, .total-row td { border-top: 2px solid #000; font-size: 13pt; padding-top: 8px; }

        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .fw-bold { font-weight: bold; }

        .btn-area { text-align: center; margin-bottom: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; }
        .btn { padding: 8px 20px; background-color: #2c3e50; color: white; border: none; cursor: pointer; font-size: 14px; border-radius: 4px; }
        .btn:hover { background-color: #1a252f; }
    </style>
</head>
<body>

    <div class="no-print btn-area">
        <button class="btn" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸° (Print)</button>
        <button class="btn" onclick="window.close()" style="background-color: #95a5a6; margin-left: 10px;">ë‹«ê¸°</button>
        <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
            * ì¸ì‡„ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í•œêµ­ì–´ 1ë¶€, ë² íŠ¸ë‚¨ì–´ 1ë¶€ê°€ ì—°ì†ìœ¼ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ê±° ë˜ ì²˜ ì› ì¥</h1>
            <div class="sub-title">(PARTNER LEDGER)</div>
            <div class="date-range">ì¡°íšŒ ê¸°ê°„: {{ start_date|date:"Y. m. d." }} ~ {{ end_date|date:"Y. m. d." }}</div>
        </div>

        <div class="info-section">
            <div class="info-box">
                <div class="info-header">ê·€í•˜ (Partner)</div>
                <table class="info-table">
                    <tr><th>ìƒí˜¸ëª…</th><td>{{ partner.name }}</td></tr>
                    <tr><th>ëŒ€í‘œì</th><td>{{ partner.contact_person|default:"-" }}</td></tr>
                    <tr><th>ì—°ë½ì²˜</th><td>{{ partner.phone|default:"-" }}</td></tr>
                    <tr><th>ì£¼ì†Œ</th><td>{{ partner.address|default:"-" }}</td></tr>
                </table>
            </div>
            <div class="info-box">
                <div class="info-header">ê³µê¸‰ì (Supplier)</div>
                <table class="info-table">
                    <tr><th>ìƒí˜¸ëª…</th><td>{{ company.name }}</td></tr>
                    <tr><th>ëŒ€í‘œì</th><td>{{ company.owner_name }}</td></tr>
                    <tr><th>ì‚¬ì—…ìë²ˆí˜¸</th><td>{{ company.business_number|default:"-" }}</td></tr>
                    <tr><th>ì£¼ì†Œ/ì—°ë½ì²˜</th><td>{{ company.phone }}</td></tr>
                </table>
            </div>
        </div>

        <table class="ledger-table">
            <thead>
                <tr>
                    <th width="12%">ì¼ì</th>
                    <th width="10%">êµ¬ë¶„</th>
                    <th>ì ìš” (í’ˆëª©)</th>
                    <th width="14%">ë§¤ì¶œ/ì²­êµ¬ (+)</th>
                    <th width="14%">ì…ê¸ˆ/ì§€ê¸‰ (-)</th>
                    <th width="15%">ì”ì•¡</th>
                </tr>
            </thead>
            <tbody>
                <tr style="background-color: #fafafa;">
                    <td class="text-center">-</td>
                    <td class="text-center">ì´ì›”</td>
                    <td>ì „ì¼ ì”ì•¡ ì´ì›”</td>
                    <td class="text-right">-</td>
                    <td class="text-right">-</td>
                    <td class="text-right fw-bold">{{ carry_over_balance|floatformat:0|intcomma }}</td>
                </tr>
                {% for t in transactions %}
                <tr>
                    <td class="text-center">{{ t.date|date:"m-d" }}</td>
                    <td class="text-center">{{ t.type }}</td>
                    <td class="text-left">{{ t.desc }}</td>
                    <td class="text-right">{% if t.amount > 0 %}{{ t.amount|floatformat:0|intcomma }}{% else %}-{% endif %}</td>
                    <td class="text-right">{% if t.amount < 0 %}{{ t.amount|stringformat:"d"|slice:"1:"|intcomma }}{% else %}-{% endif %}</td>
                    <td class="text-right">{{ t.balance|floatformat:0|intcomma }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="summary-box">
            <table class="summary-table">
                <tr><th width="60%">â‘  ê¸°ì´ˆ ì´ì›” ì”ì•¡</th><td>{{ carry_over_balance|floatformat:0|intcomma }} ì›</td></tr>
                <tr><th>â‘¡ ê¸°ê°„ ë‚´ ë§¤ì¶œ/ì²­êµ¬ í•©ê³„ (+)</th><td>+ {{ total_sales|floatformat:0|intcomma }} ì›</td></tr>
                <tr><th>â‘¢ ê¸°ê°„ ë‚´ ì…ê¸ˆ/ì§€ê¸‰ í•©ê³„ (-)</th><td>- {{ total_paid|floatformat:0|intcomma }} ì›</td></tr>
                <tr class="total-row"><th>â‘£ ìµœì¢… ì”ì•¡ (Current Balance)</th><td style="color: #2c3e50;">{{ final_balance|floatformat:0|intcomma }} ì›</td></tr>
            </table>
        </div>
        <div style="margin-top: 30px; text-align: center; font-size: 9pt; color: #555;">
            ì¶œë ¥ì¼ì‹œ: {% now "Y-m-d H:i" %} | (KR)
        </div>
    </div>

    <div class="page-break"></div>

    <div class="container">
        <div class="header">
            <h1>Sá»” CHI TIáº¾T CÃ”NG Ná»¢</h1>
            <div class="sub-title">(PARTNER LEDGER - VN)</div>
            <div class="date-range">Thá»i gian: {{ start_date|date:"d/m/Y" }} ~ {{ end_date|date:"d/m/Y" }}</div>
        </div>

        <div class="info-section">
            <div class="info-box">
                <div class="info-header">KhÃ¡ch HÃ ng (Partner)</div>
                <table class="info-table">
                    <tr><th>TÃªn cÃ´ng ty</th><td>{{ partner.name }}</td></tr>
                    <tr><th>NgÆ°á»i liÃªn há»‡</th><td>{{ partner.contact_person|default:"-" }}</td></tr>
                    <tr><th>Äiá»‡n thoáº¡i</th><td>{{ partner.phone|default:"-" }}</td></tr>
                    <tr><th>Äá»‹a chá»‰</th><td>{{ partner.address|default:"-" }}</td></tr>
                </table>
            </div>
            <div class="info-box">
                <div class="info-header">NhÃ  Cung Cáº¥p (Supplier)</div>
                <table class="info-table">
                    <tr><th>TÃªn cÃ´ng ty</th><td>{{ company.name }}</td></tr>
                    <tr><th>GiÃ¡m Ä‘á»‘c</th><td>{{ company.owner_name }}</td></tr>
                    <tr><th>MST</th><td>{{ company.business_number|default:"-" }}</td></tr>
                    <tr><th>LiÃªn há»‡</th><td>{{ company.phone }}</td></tr>
                </table>
            </div>
        </div>

        <table class="ledger-table">
            <thead>
                <tr>
                    <th width="12%">NgÃ y</th>
                    <th width="12%">Loáº¡i</th>
                    <th>Diá»…n giáº£i (Máº·t hÃ ng)</th>
                    <th width="14%">PhÃ¡t sinh Ná»£ (+)</th>
                    <th width="14%">PhÃ¡t sinh CÃ³ (-)</th>
                    <th width="15%">Sá»‘ dÆ°</th>
                </tr>
            </thead>
            <tbody>
                <tr style="background-color: #fafafa;">
                    <td class="text-center">-</td>
                    <td class="text-center">Äáº§u ká»³</td>
                    <td>Sá»‘ dÆ° Ä‘áº§u ká»³ (Carry-over)</td>
                    <td class="text-right">-</td>
                    <td class="text-right">-</td>
                    <td class="text-right fw-bold">{{ carry_over_balance|floatformat:0|intcomma }}</td>
                </tr>
                {% for t in transactions %}
                <tr>
                    <td class="text-center">{{ t.date|date:"d/m" }}</td>
                    <td class="text-center">
                        {% if t.type == 'ë§¤ì¶œ' %}BÃ¡n hÃ ng
                        {% elif t.type == 'ë§¤ì…' %}Mua hÃ ng
                        {% elif t.type == 'ì…ê¸ˆ' %}Thu tiá»n
                        {% elif t.type == 'ì¶œê¸ˆ' %}Chi tiá»n
                        {% else %}{{ t.type }}{% endif %}
                    </td>
                    <td class="text-left">{{ t.desc }}</td>
                    <td class="text-right">{% if t.amount > 0 %}{{ t.amount|floatformat:0|intcomma }}{% else %}-{% endif %}</td>
                    <td class="text-right">{% if t.amount < 0 %}{{ t.amount|stringformat:"d"|slice:"1:"|intcomma }}{% else %}-{% endif %}</td>
                    <td class="text-right">{{ t.balance|floatformat:0|intcomma }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="summary-box">
            <table class="summary-table">
                <tr><th width="60%">â‘  Sá»‘ dÆ° Ä‘áº§u ká»³</th><td>{{ carry_over_balance|floatformat:0|intcomma }} Ä‘</td></tr>
                <tr><th>â‘¡ Tá»•ng phÃ¡t sinh Ná»£ (+)</th><td>+ {{ total_sales|floatformat:0|intcomma }} Ä‘</td></tr>
                <tr><th>â‘¢ Tá»•ng phÃ¡t sinh CÃ³ (-)</th><td>- {{ total_paid|floatformat:0|intcomma }} Ä‘</td></tr>
                <tr class="total-row"><th>â‘£ Sá»‘ dÆ° cuá»‘i ká»³ (Final Balance)</th><td style="color: #2c3e50;">{{ final_balance|floatformat:0|intcomma }} Ä‘</td></tr>
            </table>
        </div>

        <div style="margin-top: 30px; text-align: center; font-size: 9pt; color: #555;">
            NgÃ y in: {% now "d/m/Y H:i" %} | (VN)
        </div>
    </div>

</body>
</html>