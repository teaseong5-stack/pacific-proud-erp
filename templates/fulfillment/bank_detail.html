{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>ğŸ“œ ì…ì¶œê¸ˆ ê±°ë˜ ë‚´ì—­</h2>
        <span class="text-muted fs-5">{{ account.bank_name }} <span class="mx-2">|</span> {{ account.account_number }}</span>
    </div>
    <div>
        <span class="fs-4 fw-bold me-3">ì”ì•¡: {{ account.current_balance|intcomma }} Ä‘</span>
        <a href="{% url 'fulfillment:bank_list' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>
</div>

<div class="card shadow">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">ê±°ë˜ ë‚´ì—­ (Transactions)</h6>
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createTransactionModal">
            <i class="bi bi-plus-lg"></i> ê±°ë˜ë‚´ì—­ ì¶”ê°€
        </button>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
                <thead class="bg-light">
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>êµ¬ë¶„</th>
                        <th>ì ìš”</th>
                        <th class="text-end">ê±°ë˜ê¸ˆì•¡</th>
                        <th class="text-end">ì”ì•¡</th>
                        <th>ë‹´ë‹¹ì</th>
                        
                        {% if user.is_superuser %}
                        <th>ê´€ë¦¬</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for tr in transactions %}
                    <tr>
                        <td>{{ tr.date|date:"Y-m-d" }}</td>
                        <td>
                            {% if tr.transaction_type == 'DEPOSIT' %}
                                <span class="badge bg-primary">ì…ê¸ˆ</span>
                            {% else %}
                                <span class="badge bg-danger">ì¶œê¸ˆ</span>
                            {% endif %}
                        </td>
                        <td class="text-start ps-3">{{ tr.description }}</td>
                        <td class="text-end fw-bold {% if tr.transaction_type == 'DEPOSIT' %}text-primary{% else %}text-danger{% endif %}">
                            {{ tr.amount|intcomma }}
                        </td>
                        <td class="text-end text-muted">{{ tr.balance_after|intcomma }}</td>
                        <td>{{ tr.created_by.username }}</td>

                        {% if user.is_superuser %}
                        <td>
                            <div class="btn-group" role="group">
                                <a href="{% url 'fulfillment:bank_transaction_update' tr.id %}" class="btn btn-sm btn-outline-secondary" title="ìˆ˜ì •">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                <form action="{% url 'fulfillment:bank_transaction_delete' tr.id %}" method="post" class="d-inline" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì”ì•¡ë„ í•¨ê»˜ ë³€ê²½ë©ë‹ˆë‹¤.');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="ì‚­ì œ">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{% if user.is_superuser %}7{% else %}6{% endif %}" class="py-4 text-muted">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}